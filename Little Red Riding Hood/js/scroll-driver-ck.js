/**
 *
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */(function(){function i(n){var r=$(n.from),i=$(n.to),s=$("#overlay"),o={keyframe:{top:r.offset().top+r.height()-window.innerHeight,height:window.innerHeight},handlers:[{},{}]},u=$.extend({},o.keyframe,n.keyframe),a=$("<div>").attr("class","pin-spacer").css({display:"none",height:r.height()+u.height}).insertAfter(r),f=new TimelineLite;f.add(e.to(s,1,{css:{autoAlpha:1},ease:Linear.easeNone,immediateRender:!1,onStart:function(){n.onStart?n.onStart.call(this):r.pin("bottom");a.show()},data:{onReverseStart:function(){this.vars.onStart.call(this)}},onComplete:function(){n.onComplete?n.onComplete.call(this):r.unpin();a.hide()},onReverseComplete:function(){n.onReverseComplete?n.onReverseComplete.call(this):r.unpin()}}));f.add(e.to(s,1,{css:{autoAlpha:0},ease:Linear.easeNone,immediateRender:!1,onStart:function(){i.pin("top");a.show()},data:{onReverseStart:function(){this.vars.onStart.call(this)}},onComplete:function(){i.unpin();a.hide();window.scrollTo(0,i.offset().top)},onReverseComplete:function(){i.unpin()}}));t.add(u,f)}function s(){var e={navigable:!0,top:0,height:0};t.add(e)}function o(){var t=e.to(n,.2,{className:"+=pin",ease:Linear.easeNone,immediateRender:!1,onStart:function(){if(n.css("position")=="fixed")return;n.pin().css({top:0})},data:{onReverseStart:function(){this.vars.onStart.call(this)}},onComplete:function(){},onReverseComplete:function(){n.unpin().css({top:"auto"})}}),s=new TimelineLite;i({from:n,to:r,duration:window.innerHeight,keyframe:{navigable:!0}})}function u(t){var n=$("#overlay"),r=function(){},i={duration:2,onStart:r,onHalfway:r,onComplete:r},s=$.extend({},i,t),o=new TimelineLite;o.add(e.to(n,s.duration/2,{ease:Linear.easeIn,css:{autoAlpha:1},onStart:s.onStart}));o.add(e.to(n,s.duration/2,{ease:Cubic.easeOut,css:{autoAlpha:0},onStart:s.onHalfway,onComplete:s.onComplete}));o.play()}function a(){var e=$("nav"),n=document.createDocumentFragment(),r=t.getKeyframes().filter(".navigable");e.delegate("a","click",function(e){e.preventDefault();var t=$($(e.target).attr("href")),n=t.offset().top+t.height(),r=window.scrollY,i=300,s=n-window.scrollY,o=Math.abs(n-r),a=3,f=o/i;f>a?u({onHalfway:function(){window.scrollTo(0,n)}}):TweenMax.to(window,f,{scrollTo:{y:n},ease:Power2.easeOut})});$.each(r,function(e,t){n.appendChild($("<a>").attr({href:"#"+t.id})[0])});e.append(n)}function f(){o();t.emALLTheThings();if(window.navigator.userAgent.indexOf("Chrome")>-1&&!("onwheel"in window)){var e=document.documentElement;e.classList.remove("shape-inside");e.classList.add("no-shape-inside")}if(document.documentElement.classList.contains("shape-inside")){var n=0,r=50,i=$("#intro");function s(e){e.preventDefault();n+=Math.abs(window.scrollY);if(n>r){i.addClass("hide").on("transitionEnd webkitTransitionEnd",function(e){i.remove()});window.removeEventListener("scroll",s)}}window.addEventListener("scroll",s)}}$.fn.pin=function(e){function t(t){t.css({position:"fixed",top:e==="top"?0:"auto",bottom:e==="bottom"?0:"auto",left:0,zIndex:1})}e=["top","bottom"].indexOf(e)!==-1?e:"top";return $(this).each(function(){t($(this))})};$.fn.unpin=function(){function e(e){if(e.css("position")!=="fixed")return;e.css({position:"relative",top:"auto",botton:"auto",left:"auto",zIndex:"auto"})}return $(this).each(function(){e($(this))})};$.some=function(e,t,n){var r=!1;if(e==null)return r;if(Array.prototype.some&&e.some===Array.prototype.some)return e.some(t,n);$.each(e,function(e,i,s){if(r||(r=t.call(n,e,i,s)))return{}});return!!r};var e=function(){function e(){var e=function(){},t=Array.prototype.slice.call(arguments,0),n=t[2];if(!n)return t;var r=n.onStart||e,i=n.onUpdate||e,s=$.extend(n,{onStart:function(){this._lastProgress=this.totalProgress();r.call(this)},onUpdate:function(){this._lastProgress===1&&this._lastProgress>this.totalProgress()&&this.vars.data&&this.vars.data.onReverseStart&&this.vars.data.onReverseStart.call(this);this._lastProgress=this.totalProgress();i.call(this)}});t.splice(2,1,s);return t}function t(){}t.prototype.to=function(){return TweenMax.to.apply(this,e.apply(this,arguments))};t.prototype.from=function(){return TweenMax.from.apply(this,e.apply(this,arguments))};return new t}(),t=function(){var e=$("#timeline"),t=0,n=!1,r=new $.superscrollorama({triggerAtCenter:!1,playoutAnimations:!1}),i=function(n){var r="key"+ ++t,i={top:0,height:"20px"};return $("<div>").css($.extend({},i,n)).attr("id",r).attr("class",function(){return n.navigable?"navigable":null}).appendTo(e)};return{add:function(e,t){var n=i(e);t&&r.addTween(n,t,n.height());return n},emALLTheThings:function(){if(n)return;var t=parseInt(window.getComputedStyle(document.body)["font-size"],10);e.find("div").each(function(){var e=$(this);e.css({top:parseInt(e.css("top"),10)/t+"em",height:parseInt(e.css("height"),10)/t+"em"})});$(".pin-spacer").each(function(){$spacer=$(this);$spacer.css({height:parseInt($spacer.css("height"),10)/t+"em"})});r.triggerCheckAnim(!0);n=!0},getKeyframes:function(){return e.find("div")}}}(),n=$("#scene1"),r=$("#scene2");$(f);$.each(["shape-inside","flow-into"],function(e,t){var n=$.some(["-webkit-","-ms-","-moz-",""],function(e){return e+t in document.body.style});t=n?t:"no-"+t;document.documentElement.classList.add(t)})})();