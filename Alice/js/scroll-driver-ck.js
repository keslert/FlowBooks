/**
 *
 * Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */(function(){function o(n){var r=$(n.from),i=$(n.to),s=$("#overlay"),o={keyframe:{top:r.offset().top+r.height()-window.innerHeight,height:window.innerHeight},handlers:[{},{}]},u=$.extend({},o.keyframe,n.keyframe),a=$("<div>").attr("class","pin-spacer").css({display:"none",height:r.height()+u.height}).insertAfter(r),f=new TimelineLite;f.add(e.to(s,1,{css:{autoAlpha:1},ease:Linear.easeNone,immediateRender:!1,onStart:function(){n.onStart?n.onStart.call(this):r.pin("bottom");a.show()},data:{onReverseStart:function(){this.vars.onStart.call(this)}},onComplete:function(){n.onComplete?n.onComplete.call(this):r.unpin();a.hide()},onReverseComplete:function(){n.onReverseComplete?n.onReverseComplete.call(this):r.unpin()}}));f.add(e.to(s,1,{css:{autoAlpha:0},ease:Linear.easeNone,immediateRender:!1,onStart:function(){i.pin("top");a.show()},data:{onReverseStart:function(){this.vars.onStart.call(this)}},onComplete:function(){i.unpin();a.hide();window.scrollTo(0,i.offset().top)},onReverseComplete:function(){i.unpin()}}));t.add(u,f)}function u(){var e={navigable:!0,top:0,height:0};t.add(e)}function a(){var i=$("#scene1 p"),s=i.height()+n.height()-i.height()-i.offset().top,a={top:i.offset().top/4,height:s},f=e.to(i,1,{css:{marginTop:s}});u();t.add(a,f);o({from:n,to:r,duration:window.innerHeight,keyframe:{navigable:!0}})}function f(){var n=$("#scene2 .falling1"),r=new TimelineLite,i={top:n.offset().top-window.innerHeight/4,height:n.height()};r.add(e.from(n,.25,{css:{autoAlpha:0,transform:"translateY(-70px) rotate(-45deg) scale(0.85)"}}));r.add(e.to(n,.75,{css:{autoAlpha:1,transform:"translateY(70px) rotate(-45deg) scale(0.85)"}}));r.defaultEasing=Linear.easeNone;t.add(i,r);var s=$("#scene2 .falling2"),o=new TimelineLite,u={top:s.offset().top-window.innerHeight/2,height:s.height()};o.add(e.from(s,.25,{css:{autoAlpha:0,transform:"translateY(-50px) rotate(-25deg) scale(0.85)"}}));o.add(e.to(s,.25,{css:{autoAlpha:0,transform:"translateY(50px) rotate(-25deg) scale(0.85)"}}));o.defaultEasing=Linear.easeNone;t.add(u,o);var a=$("#scene2 .act1 .alice-shape"),f=e.from(a,.25,{css:{autoAlpha:0}}),l={top:a.offset().top-window.innerHeight/2,height:a.height()*1.5};t.add(l,f)}function l(){var n=r.find(".act2"),s=r.find(".decoration"),u=window.innerHeight-n.height(),a=Math.max(Math.abs(window.innerWidth-(n.offset().left+n.width())),s.offset().left),f={top:n.offset().top-u,height:n.height()+a+window.innerHeight},l={top:f.top+f.height,height:window.innerHeight*5*2},h=$("<div>").attr("class","pin-spacer").css({height:f.height+l.height}).insertAfter(r),p=e.to(r,.2,{className:"+=pin",ease:Linear.easeNone,immediateRender:!1,onStart:function(){if(r.css("position")=="fixed")return;r.pin().css({top:-1*s.height()+u+"px"})},data:{onReverseStart:function(){this.vars.onStart.call(this)}},onComplete:function(){},onReverseComplete:function(){r.unpin().css({top:"auto"})}}),d=new TimelineLite;d.add(e.to(r,1,{css:{left:-1*a+"px"},ease:Linear.easeNone,immediateRender:!1}));d.add(e.to(n,1,{className:"+=day"}));var v=c();t.add(f,p);t.add($.extend({},f,{navigable:!0}),d);t.add(l,v);var m=function(){if(r.css("position")=="fixed")return;r.pin().css({left:-1*a+"px",top:-1*s.height()+u+"px"})};o({from:r,to:i,keyframe:{navigable:!0,top:l.top+l.height+window.innerHeight-u,height:window.innerHeight},onStart:m,onReverseComplete:m,onComplete:function(){r.unpin().css({top:"auto"})}})}function c(){var t=new TimelineLite,n=$("#scene2 .dialogue1"),r=n.find(".caterpillar p"),i=n.find(".alice"),s=new TimelineLite;s.add(e.to(r,5,{className:"+=visible"}));s.add(e.to(i,2,{className:"+=visible"}));s.add(e.to(r,5,{delay:-1,bezier:[{left:-50,top:-100},{left:30,top:-150},{left:-150,top:-300}],ease:Power1.easeInOut}));s.add(e.to(i,2,{className:"+=hidden"}));t.add(s);var o=$("#scene2 .dialogue2"),u=o.find(".caterpillar p"),a=o.find(".alice"),f=new TimelineLite;f.add(e.to(u,5,{className:"+=visible"}));f.add(e.to(a,2,{className:"+=visible"}));f.add(e.to(u,5,{delay:-1,bezier:[{left:-50,top:-100},{left:50,top:-150},{left:220,top:-250}],ease:Power1.easeInOut}));f.add(e.to(a,2,{delay:-1,className:"+=hidden"}));t.add(f);var l=$("#scene2 .dialogue3"),c=l.find(".caterpillar p"),h=l.find(".alice"),p=new TimelineLite;p.add(e.to(c,5,{className:"+=visible"}));p.add(e.to(h,2,{className:"+=visible"}));p.add(e.to(c,5,{delay:-1,bezier:[{left:50,top:-70},{left:-20,top:-130},{left:-70,top:-150},{left:0,top:-230}],ease:Power1.easeInOut}));p.add(e.to(h,2,{delay:-1,className:"+=hidden"}));t.add(p);var d=$("#scene2 .dialogue4"),v=d.find(".caterpillar p"),m=d.find(".alice"),g=new TimelineLite;g.add(e.to(v,5,{className:"+=visible"}));g.add(e.to(m,2,{className:"+=visible"}));g.add(e.to(v,5,{delay:-1,bezier:[{left:-50,top:-70},{left:30,top:-120},{left:150,top:-150}],ease:Power1.easeInOut}));g.add(e.to(m,2,{delay:-1,className:"+=hidden"}));t.add(g);var y=$("#scene2 .dialogue5"),b=y.find(".caterpillar p"),w=y.find(".alice"),E=new TimelineLite;E.add(e.to(b,5,{className:"+=visible"}));E.add(e.to(w,2,{className:"+=visible"}));E.add(e.to(b,5,{delay:-1,bezier:[{left:50,top:-30},{left:-50,top:-70},{left:-200,top:-160}],ease:Power1.easeInOut}));t.add(E);return t}function h(){var n=$("#scene3_1 .cat-shape2"),r={enter:{top:n.offset().top-window.innerHeight/2,height:n.height()*2},exit:{top:n.offset().top,height:n.height()}};t.add(r.enter,e.from(n,1,{css:{autoAlpha:0,transform:"translateY(-40px)"}}));t.add(r.enter,e.from(n.next("p"),1,{css:{autoAlpha:0}}));t.add(r.exit,e.to(n,.25,{css:{autoAlpha:0}}));t.add(r.exit,e.to(n.next("p"),.25,{css:{autoAlpha:0}}));var i=$("#scene3_1 .cat-shape3"),r={enter:{top:i.offset().top-window.innerHeight/2,height:i.height()},exit:{top:i.offset().top,height:100}};t.add(r.enter,e.from(i,1,{css:{autoAlpha:0,transform:"translateY(-25px)"}}));t.add(r.enter,e.from(i.next("p"),1,{css:{autoAlpha:0}}));t.add(r.exit,e.to(i,1,{css:{autoAlpha:0}}));t.add(r.exit,e.to(i.next("p"),.25,{css:{autoAlpha:0}}));var s=$("#scene3_1 .cat-shape4"),r={enter:{top:s.offset().top-window.innerHeight/2,height:s.height()},exit:{top:s.offset().top,height:200}};t.add(r.enter,e.from(s,1,{css:{autoAlpha:0,transform:"translateY(-45px)"}}));t.add(r.enter,e.from(s.next("p"),1,{css:{autoAlpha:0}}));t.add(r.exit,e.to(s,1,{css:{autoAlpha:0}}));t.add(r.exit,e.to(s.next("p"),.25,{css:{autoAlpha:0}}));var o=$("#scene3_2 .cat-shape5"),r={enter:{top:o.offset().top-window.innerHeight/2,height:o.height()},exit:{top:o.offset().top+o.offset().left-window.innerWidth/2,height:window.innerHeight/2}};t.add($.extend({},r.enter,{navigable:!0}),e.from(o,1,{css:{autoAlpha:0,transform:"translateY(-35px)"}}));t.add(r.enter,e.from(o.next("p"),1,{css:{autoAlpha:0}}));t.add(r.exit,e.to(o,1,{css:{autoAlpha:0}}));t.add(r.exit,e.to(o.next("p"),.25,{css:{autoAlpha:0}}))}function p(){var n=s,r=s.find(".act6"),i=0,o={catHead:window.innerHeight*2},u=n.width()-window.innerWidth,a=Math.min(r.position().top,n.height()-window.innerHeight),f={top:n.offset().top,height:window.innerHeight+n.width()-window.innerWidth+i},l=$("<div>").attr("class","pin-spacer").css({height:f.height+window.innerHeight+o.catHead}).insertAfter(n),c=e.to(n,.2,{className:"+=pin",ease:Linear.easeNone,immediateRender:!1,onStart:function(){s.pin().css({top:0,left:n.css("left")})},data:{onReverseStart:function(){this.vars.onStart.call(this)}},onReverseComplete:function(){n.unpin().css({top:"auto"})}}),h=new TimelineLite;h.add(e.to(n,1,{css:{left:-1*u/2+"px"},ease:Linear.easeNone,immediateRender:!1}));h.add(e.to(n,1,{css:{left:-1*u+"px",top:-1*a+"px"},ease:Linear.easeNone,immediateRender:!1}));t.add(f,c);t.add(f,h);d();v();var p=$("#scene3_2 .act6 .cat-head"),m=p.find(".state"),g=new TimelineLite;g.defaultEasing=Linear.easeNone;m.each(function(t,n){g.add(e.to($(n),1,{css:{autoAlpha:1}}))});t.add({navigable:!0,top:f.height+f.top,height:o.catHead},g)}function d(){var n=$("#scene3_2 .act2 .cat-shape-walking"),r=$("#scene3_2 .act2 .content-wrapper p"),i={enter:{top:s.offset().top+n.offset().left-window.innerWidth/2,height:n.height()},exit:{top:s.offset().top+n.offset().left-window.innerWidth/2+window.innerHeight,height:n.height()/2}};t.add(i.enter,e.from(n,1,{css:{autoAlpha:0,transform:"translateX(-20px) rotate(7deg)"}}));t.add(i.enter,e.from(r,1,{css:{autoAlpha:0},transform:"translateX(-100px)"}));t.add(i.exit,e.to(n,1,{css:{autoAlpha:0,transform:"translateX(20px) rotate(7deg)"}}));t.add(i.exit,e.to(r,1,{css:{autoAlpha:0}}))}function v(){var n=$("#scene3_2 .act3"),r=n.find(".alice-shape"),i=n.find(".content-wrapper"),o=$("#scene3_2 .act4"),u=o.find(".alice-shape"),a=o.find(".content-wrapper"),f=$("#scene3_2 .act5"),l=f.find(".alice-shape"),c=new TimelineLite;c.add(e.to(r,1,{css:{autoAlpha:1}}));c.add(e.to(i,1,{delay:-0.75,css:{autoAlpha:1},transform:"translateX(50px)"}));c.add(e.to(r,1,{css:{autoAlpha:0}}));c.add(e.to(i,1,{delay:-0.5,css:{autoAlpha:0}}));c.add(e.to(u,1,{delay:-0.5,css:{autoAlpha:1}}));c.add(e.to(a,1,{delay:-0.75,css:{autoAlpha:1}}));c.add(e.to(u,1,{delay:0,css:{autoAlpha:0}}));c.add(e.to(l,1,{delay:0,css:{autoAlpha:1}}));var h={top:s.offset().top+n.offset().left-window.innerHeight/3,height:f.offset().left-n.offset().left};t.add(h,c)}function m(t){var n=$("#overlay"),r=function(){},i={duration:2,onStart:r,onHalfway:r,onComplete:r},s=$.extend({},i,t),o=new TimelineLite;o.add(e.to(n,s.duration/2,{ease:Linear.easeIn,css:{autoAlpha:1},onStart:s.onStart}));o.add(e.to(n,s.duration/2,{ease:Cubic.easeOut,css:{autoAlpha:0},onStart:s.onHalfway,onComplete:s.onComplete}));o.play()}function g(){var e=$("nav"),n=document.createDocumentFragment(),r=t.getKeyframes().filter(".navigable");e.delegate("a","click",function(e){e.preventDefault();var t=$($(e.target).attr("href")),n=t.offset().top+t.height(),r=window.scrollY,i=300,s=n-window.scrollY,o=Math.abs(n-r),u=3,a=o/i;a>u?m({onHalfway:function(){window.scrollTo(0,n)}}):TweenMax.to(window,a,{scrollTo:{y:n},ease:Power2.easeOut})});$.each(r,function(e,t){n.appendChild($("<a>").attr({href:"#"+t.id})[0])});e.append(n)}function y(){a();f();l();h();p();t.emALLTheThings();if(window.navigator.userAgent.indexOf("Chrome")>-1&&!("onwheel"in window)){var e=document.documentElement;e.classList.remove("shape-inside");e.classList.add("no-shape-inside")}if(document.documentElement.classList.contains("shape-inside")){var n=0,r=50,i=$("#intro");function s(e){e.preventDefault();n+=Math.abs(window.scrollY);if(n>r){i.addClass("hide").on("transitionEnd webkitTransitionEnd",function(e){i.remove()});window.removeEventListener("scroll",s)}}window.addEventListener("scroll",s)}}$.fn.pin=function(e){function t(t){t.css({position:"fixed",top:e==="top"?0:"auto",bottom:e==="bottom"?0:"auto",left:0,zIndex:1})}e=["top","bottom"].indexOf(e)!==-1?e:"top";return $(this).each(function(){t($(this))})};$.fn.unpin=function(){function e(e){if(e.css("position")!=="fixed")return;e.css({position:"relative",top:"auto",botton:"auto",left:"auto",zIndex:"auto"})}return $(this).each(function(){e($(this))})};$.some=function(e,t,n){var r=!1;if(e==null)return r;if(Array.prototype.some&&e.some===Array.prototype.some)return e.some(t,n);$.each(e,function(e,i,s){if(r||(r=t.call(n,e,i,s)))return{}});return!!r};var e=function(){function e(){var e=function(){},t=Array.prototype.slice.call(arguments,0),n=t[2];if(!n)return t;var r=n.onStart||e,i=n.onUpdate||e,s=$.extend(n,{onStart:function(){this._lastProgress=this.totalProgress();r.call(this)},onUpdate:function(){this._lastProgress===1&&this._lastProgress>this.totalProgress()&&this.vars.data&&this.vars.data.onReverseStart&&this.vars.data.onReverseStart.call(this);this._lastProgress=this.totalProgress();i.call(this)}});t.splice(2,1,s);return t}function t(){}t.prototype.to=function(){return TweenMax.to.apply(this,e.apply(this,arguments))};t.prototype.from=function(){return TweenMax.from.apply(this,e.apply(this,arguments))};return new t}(),t=function(){var e=$("#timeline"),t=0,n=!1,r=new $.superscrollorama({triggerAtCenter:!1,playoutAnimations:!1}),i=function(n){var r="key"+ ++t,i={top:0,height:"20px"};return $("<div>").css($.extend({},i,n)).attr("id",r).attr("class",function(){return n.navigable?"navigable":null}).appendTo(e)};return{add:function(e,t){var n=i(e);t&&r.addTween(n,t,n.height());return n},emALLTheThings:function(){if(n)return;var t=parseInt(window.getComputedStyle(document.body)["font-size"],10);e.find("div").each(function(){var e=$(this);e.css({top:parseInt(e.css("top"),10)/t+"em",height:parseInt(e.css("height"),10)/t+"em"})});$(".pin-spacer").each(function(){$spacer=$(this);$spacer.css({height:parseInt($spacer.css("height"),10)/t+"em"})});r.triggerCheckAnim(!0);n=!0},getKeyframes:function(){return e.find("div")}}}(),n=$("#scene1"),r=$("#scene2"),i=$("#scene3_1"),s=$("#scene3_2");$(y);$.each(["shape-inside","flow-into"],function(e,t){var n=$.some(["-webkit-","-ms-","-moz-",""],function(e){return e+t in document.body.style});t=n?t:"no-"+t;document.documentElement.classList.add(t)})})();